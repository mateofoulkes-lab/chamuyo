<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Chamuyo – Test de Conectividad</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body{
    font-family: system-ui, sans-serif;
    background:#eef6fb;
    padding:20px;
  }
  h1{ margin-top:0 }
  button{
    display:block;
    width:100%;
    padding:12px;
    margin:8px 0;
    font-size:14px;
    border-radius:10px;
    border:1px solid #bbb;
    background:#fff;
  }
  button:hover{ background:#f0f0f0 }
  pre{
    background:#0b1c24;
    color:#d7f6ff;
    padding:12px;
    border-radius:10px;
    max-height:300px;
    overflow:auto;
    font-size:12px;
  }
</style>
</head>

<body>

<h1>Chamuyo – Test incremental</h1>
<p>Probá los botones en orden. Decime hasta cuál funciona.</p>

<button onclick="test1()">1️⃣ Ping web pública (google.com)</button>
<button onclick="test2()">2️⃣ Ping GitHub Pages (self)</button>
<button onclick="test3()">3️⃣ Abrir InfinityFree (GET directo)</button>
<button onclick="test4()">4️⃣ Fetch simple InfinityFree (GET sin headers)</button>
<button onclick="test5()">5️⃣ Fetch con querystring</button>
<button onclick="test6()">6️⃣ Fetch POST simple (form-urlencoded)</button>
<button onclick="test7()">7️⃣ Fetch que fuerza preflight (JSON)</button>

<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");

function log(msg){
  logEl.textContent += msg + "\n";
  logEl.scrollTop = logEl.scrollHeight;
}

async function run(name, fn){
  log("\n=== " + name + " ===");
  try{
    const res = await fn();
    log("✅ OK");
    if (res !== undefined) log(String(res).slice(0,500));
  }catch(e){
    log("❌ ERROR");
    log(String(e));
  }
}

/* 1) Fetch a web pública */
function test1(){
  run("Test 1 – google.com", async ()=>{
    const r = await fetch("https://www.google.com", { mode:"no-cors" });
    return "fetch realizado (no-cors, status oculto)";
  });
}

/* 2) Fetch al propio GitHub Pages */
function test2(){
  run("Test 2 – GitHub Pages self", async ()=>{
    const r = await fetch(location.href);
    return "status: " + r.status;
  });
}

/* 3) Abrir InfinityFree (solo GET simple) */
function test3(){
  run("Test 3 – InfinityFree GET directo", async ()=>{
    const r = await fetch("https://chamuyo.gamer.gd/debug_db.php");
    const t = await r.text();
    return "status: " + r.status + "\n" + t.slice(0,200);
  });
}

/* 4) Fetch simple (sin headers) */
function test4(){
  run("Test 4 – InfinityFree GET simple", async ()=>{
    const r = await fetch("https://chamuyo.gamer.gd/api.php?action=roomState&code=XXXXXX");
    const t = await r.text();
    return "status: " + r.status + "\n" + t;
  });
}

/* 5) GET con querystring distinta */
function test5(){
  run("Test 5 – GET con query random", async ()=>{
    const r = await fetch("https://chamuyo.gamer.gd/api.php?action=roomState&code=XXXXXX&x="+Date.now());
    return "status: " + r.status;
  });
}

/* 6) POST simple (no preflight) */
function test6(){
  run("Test 6 – POST form-urlencoded", async ()=>{
    const r = await fetch("https://chamuyo.gamer.gd/api.php?action=createRoom", {
      method:"POST",
      headers:{ "Content-Type":"application/x-www-form-urlencoded" },
      body:"name=Test"
    });
    const t = await r.text();
    return "status: " + r.status + "\n" + t;
  });
}

/* 7) POST JSON (fuerza OPTIONS / preflight) */
function test7(){
  run("Test 7 – POST JSON (preflight)", async ()=>{
    const r = await fetch("https://chamuyo.gamer.gd/api.php?action=createRoom", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ name:"Test" })
    });
    const t = await r.text();
    return "status: " + r.status + "\n" + t;
  });
}
</script>

</body>
</html>
